apiVersion: "cilium.io/v2"
kind: CiliumNetworkPolicy
metadata:
  name: ztp-traefik-rule
  namespace: edge
spec:
  description: "ZTP policy to restrict all ingress traffic except from busybox pods, and only allow egress traffic to DNS via coredns pods"
  endpointSelector: 
    matchLabels:
      app: traefik
  ingress:
  - fromEndpoints:
    - matchLabels:
        app: busybox
    toPorts:
    - ports:
      - port: "80"
        protocol: TCP 
  egress:
  - toEndpoints:
    - matchLabels:
        k8s-app: kube-dns
    toPorts:
    - ports:  
      - port: "53"
        protocol: UDP
      - port: "53"
        protocol: TCP
